<script>
    // --- As suas configurações foram inseridas aqui ---
    const API_BASE_URL = 'https://novaapi-one.vercel.app';
    const SELLER_API_KEY = 'a0b2f4ce-2011-4faf-9e77-52e59bbcb02b';
    const PRESSEL_ID = 49;
    const TELEGRAM_USERNAME = 'joycebimbbbot';
    const WHITE_PAGE_URL = 'https://shopee.com.br/i39ujg82gw?categoryId=100001&entryPoint=ShopByPDP&itemId=9928131970';
    const PIXELS_TO_TRACK = [{"id": "1817379038816925"}];

    // Função para extrair um cookie pelo nome
    const getCookie = (name) => document.cookie.match(new RegExp(`(^| )${name}=([^;]+)`))?.[2] || null;

    // Função principal que envia o clique para a API
    async function registerAndRedirect() {
        try {
            const params = new URLSearchParams(window.location.search);
            const response = await fetch(`${API_BASE_URL}/api/registerClick`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    sellerApiKey: SELLER_API_KEY,
                    presselId: PRESSEL_ID,
                    referer: document.referrer || null,
                    fbclid: params.get("fbclid"),
                    fbp: getCookie("_fbp"),
                    fbc: getCookie("_fbc"),
                    user_agent: navigator.userAgent,
                    utm_source: params.get("utm_source"),
                    utm_campaign: params.get("utm_campaign"),
                    utm_medium: params.get("utm_medium"),
                    utm_content: params.get("utm_content"),
                    utm_term: params.get("utm_term")
                })
            });
            const data = await response.json();
            if (response.ok && data.status === "success") {
                window.location.replace(`https://t.me/${TELEGRAM_USERNAME}?start=${data.click_id}`);
            } else {
                window.location.replace(WHITE_PAGE_URL);
            }
        } catch (error) {
            console.error("Erro ao registrar clique:", error);
            window.location.replace(WHITE_PAGE_URL);
        }
    }

    // Inicia o processo de registro e redirecionamento assim que a página carrega
    window.onload = registerAndRedirect;
</script>
